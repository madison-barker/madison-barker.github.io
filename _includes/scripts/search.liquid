{% if site.search_enabled %}
  <script type="module" src="{{ '/assets/js/search/ninja-keys.min.js' | relative_url | bust_file_cache }}"></script>
  <ninja-keys hideBreadcrumbs noAutoLoadMdIcons placeholder="Type to start searching"></ninja-keys>
  <script>
    let searchTheme = determineComputedTheme();
    const ninjaKeys = document.querySelector('ninja-keys');

    if (searchTheme === 'dark') {
      ninjaKeys.classList.add('dark');
    } else {
      ninjaKeys.classList.remove('dark');
    }

    const openSearchModal = () => {
      // collapse navbarNav if expanded on mobile
      const $navbarNav = $('#navbarNav');
      if ($navbarNav.hasClass('show')) {
        $navbarNav.collapse('hide');
      }
      ninjaKeys.open();
    };
  </script>
  <script>
    // get the ninja-keys element
    const ninja = document.querySelector('ninja-keys');

    // add the home and navigation menu items
    ninja.data = [
      // Home link
      {
        id: "nav-home",
        title: "Home",
        section: "Navigation",
        handler: () => {
          window.location.href = "{{ '/' | relative_url }}";
        },
      },
      
      // Navigation Pages (including Projects)
      {%- assign sorted_pages = site.pages | sort: "nav_order" -%}
      {%- for p in sorted_pages -%}
        {%- if p.nav and p.autogen == null -%}
          {%- assign title = p.title | escape | strip -%}
          {
            id: "nav-{{ title | slugify }}",
            title: "{{ title | truncatewords: 13 }}",
            description: "{{ p.description | strip_html | strip_newlines | escape | strip }}",
            section: "Navigation",
            handler: () => {
              window.location.href = "{{ p.url | relative_url }}";
            },
          },
        {%- endif -%}
      {%- endfor -%}
      
      // Theme section
      {%- if site.enable_darkmode -%}
        {
          id: 'light-theme',
          title: 'Change theme to light',
          description: 'Change the theme of the site to Light',
          section: 'Theme',
          handler: () => {
            setThemeSetting("light");
          },
        },
        {
          id: 'dark-theme',
          title: 'Change theme to dark',
          description: 'Change the theme of the site to Dark',
          section: 'Theme',
          handler: () => {
            setThemeSetting("dark");
          },
        },
        {
          id: 'system-theme',
          title: 'Use system default theme',
          description: 'Change the theme of the site to System Default',
          section: 'Theme',
          handler: () => {
            setThemeSetting("system");
          },
        },
      {%- endif -%}
      
      // Dummy items to ensure search works (Replace with actual searchable data if needed)
      {
        id: "dummy-1",
        title: "Placeholder Item 1",
        section: "Placeholder",
        handler: () => {
          alert("This is a placeholder item.");
        },
      },
      {
        id: "dummy-2",
        title: "Placeholder Item 2",
        section: "Placeholder",
        handler: () => {
          alert("This is another placeholder item.");
        },
      }
    ];
  </script>
  <script src="{{ '/assets/js/shortcut-key.js' | relative_url | bust_file_cache }}"></script>
{% endif %}
